# Обработчик событий и агент для логирования изменений в инфоблоках


### 1. Обработчик событий (Event Handler)
- Подписан на события `OnAfterIBlockElementAdd` и `OnAfterIBlockElementUpdate`
- Логирует все изменения элементов инфоблоков (кроме самого инфоблока LOG)
- Создает структурированный лог в инфоблоке LOG

### 2. Агент (Agent)
- Регулярно очищает старые логи, оставляя только 10 самых свежих записей
- Работает в фоновом режиме без удаления из админки

Для добавления агента в систему используйте следующий код в командной PHP-строке:

```php
\CAgent::AddAgent(
    '\Only\Site\Agents\Iblock::clearOldLogs();',
    'only.site', // модуль
    'N', // is periodic
    3600, // interval (1 час)
    '', // date check
    'Y', // active
    '', // next exec
    30 // priority
);
```

**Где найти:**
Административный раздел → Настройки → Инструменты → Командная PHP-строка

## Функциональные особенности реализации

1. **Структура логов**:
   - Каждый лог попадает в соответствующий раздел инфоблока
   - Разделы автоматически создаются по схеме `Имя инфоблока`

2. **Формат записи**:
   - Название элемента = ID логируемого элемента
   - Дата активности = дата добавления\изменения
   - Описание содержит полный путь: `Инфоблок → Раздел → Подраздел → Элемент`

   - Поддерживается любая глубина вложенности

4. **Очистка логов**:
   - Агент сохраняет 10 последних записей в каждом разделе
   - Работает раз в час без нагрузки на систему
